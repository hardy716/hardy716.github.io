---
layout: post
title: MAK-E-AT TroubleShooting #3
image: /assets/img/blog/error.jpg
accent_image: 
  background: url('/assets/img/blog/error.jpg') center/cover
  overlay: false
accent_color: '#ccc'
theme_color: '#ccc'
description: >
  flutter_webview_plugin을 Android V2 embedding으로 마이그레이션하기˚
invert_sidebar: true
---

# [Error] The plugin flutter_webview_plugin uses a deprecated version of the Android embedding.

* toc
{:toc}


```bash
The plugin flutter_webview_plugin uses a deprecated version of the Android embedding.
To avoid unexpected runtime failures, or future build failures, try to see if this plugin supports the Android V2 embedding.
Otherwise, consider removing it since a future release of Flutter will remove these deprecated APIs.
```

## 상황

flutter_webview_plugin 패키지를 사용해서 네이버 소셜 로그인 페이지를 웹뷰로 띄워주는 과정에서 큰 문제없이 동작은 하지만 위와 같은 에러가 발생했다.


## 에러 분석

네이버의 소셜 로그인 페이지를 웹뷰로 띄우는 과정에서 사용한 `flutter_webview_plugin` 패키지와 관련된 문제로, deprecated(사용 중단)된 Android embedding 버전을 사용하고 있다는 경고이다. 

( Android embedding에 대해 간단히 설명하자면, 플러터 프로젝트의 안드로이드 앱 통합 방식이다. )

기존에 사용하던 Android V1 embedding 방식에서 2019년에 Flutter 1.12와 함께 Android V2 embedding 방식이 도입되었는데,
`flutter_webview_plugin` 패키지는 V2로 마이그레이션이 되지 않아 사용이 중지된 Android V1 embedding 방식을 아직 사용하는 것 같다.

위 에러를 방치하면, 향후 빌드 실패나 런타임 오류가 발생할 위험이 있기 때문에 가능하면 해결하는 것이 좋다고 생각했다.


## 해결 방법

해결을 위해서는, 해당 플러그인을 V2로 직접 마이그레이션하거나 이미 마이그레이션이 완료된 다른 패키지의 사용을 고려해보아야 했고, 내가 택한 방법은 전자였다.

우선 `pub.dev`에 가서 제가 사용한 버전(^0.4.0)이 최신 버전이며, [flutter_webview_plugin](https://pub.dev/packages/flutter_webview_plugin)의 최신 업데이트가 22개월 전이라는 사실을 확인했다.

해당 플러그인의 [공식 깃허브 저장소 - fluttercommunity/flutter_webview_plugin](https://github.com/fluttercommunity/flutter_webview_plugin)를 살펴보니, 예상대로 많은 사람들이 deprecated version에 대해 이슈들을 생성한 것을 볼 수 있었고, 직접 문제점을 해결하려고 시도하신 분들도 간간히 보였다. 


### 마이그레이션 방법은 아래 문서들을 주로 참고했다.

[Supporting the new Android plugins APIs](https://docs.flutter.dev/release/breaking-changes/plugin-api-migration)

[Upgrading pre 1.12 Android projects](https://github.com/flutter/flutter/wiki/Upgrading-pre-1.12-Android-projects)


### 우선 두 방식의 차이점에 대해서 알아보았다.

1. **Android V1 embedding** 방식

- `io.flutter.app.FlutterActivity` 클래스를 사용한다.

- `android.app.Activity`를 직접 상속한다.

- `FlutterView`를 사용하여 플러터 엔진을 호스팅하고 렌더링한다.

- `PluginRegistry`를 사용하여 플러그인을 등록하고 관리한다.
    
2. **Android V2 embedding** 방식

- `io.flutter.embedding.android.FlutterActivity` 클래스를 사용한다.

- `androidx.appcompat.app.AppCompatActivity`를 상속한다.

- `FlutterEngine` 클래스를 사용하여 플러터 엔진을 관리하고 `FlutterView`를 사용하여 렌더링한다.

- `FlutterEngine`을 사용하여 플러그인을 등록하고 관리하며, 각 플러그인은 `io.flutter.embedding.engine.plugins.FlutterPlugin` 인터페이스를 구현해야 한다.
    

## 마이그레이션 진행 단계

### 플러그인 (공식) 레포지토리 포크 및 클론

### 안드로이드 프로젝트 설정 업데이트

### AndroidX 마이그레이션

### 플러그인 등록 코드 수정

### 플러그인 코드 수정

### 기존 플러그인 대신 적용(테스트)

### 변경 사항 반영 
